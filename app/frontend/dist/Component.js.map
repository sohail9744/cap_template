{"version":3,"file":"Component.js","names":["createDeviceModel","___model_models","getConfidentialInfo","___env","Component","BaseComponent","extend","metadata","manifest","init","_init","this","_loadScripts","BaseComponent.prototype.init.call","oRouter","getRouter","initialize","_logRouteName","setModel","scripts","forEach","script","tag","document","createElement","src","head","appendChild","_this","authInfo","userLock","getModel","oDataModel","attachRouteMatched","ev","oRouteName","getParameter","userEmail","sap","ushell","Container","getService","getEmail","production","mockEmail","Promise","resolve","navTo","userId","includes","split","toString","newUser","JSON","stringify","parseInt","setProperty","userAuthentication","reports","create","settings","analytics","navListModel","navListData","title","icon","key","push","items","authData","getProperty","e","reject"],"sources":["Component.ts"],"sourcesContent":["import BaseComponent from \"sap/ui/core/UIComponent\";\nimport { createDeviceModel } from \"./model/models\";\nimport { getConfidentialInfo } from \"./env\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport { GET } from \"./utlity/apiCall\";\nimport ODataModel from \"sap/ui/model/odata/v4/ODataModel\";\nimport Filter from \"sap/ui/model/Filter\";\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\n\n/**\n * @namespace wisys.frontend\n */\nexport default class Component extends BaseComponent {\n  public static metadata = {\n    manifest: \"json\",\n  };\n\n  /**\n   * The component is initialized by UI5 automatically during the startup of the app and calls the init method once.\n   * @public\n   * @override\n   */\n  private oDataModel: ODataModel;\n  public init(): void {\n    // Load the XLSX scripts dynamically\n    this._loadScripts();\n    // call the base component's init function\n    super.init();\n\n    const oRouter = this.getRouter();\n    oRouter.initialize();\n\n    // Log route name\n    this._logRouteName(oRouter);\n\n    // set the device model\n    this.setModel(createDeviceModel(), \"device\");\n  }\n  private _loadScripts(): any {\n    const scripts = [\n      \"https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js\",\n      \"https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js\",\n      \"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js\",\n      \"https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js\",\n    ];\n    scripts.forEach((script) => {\n      const tag = document.createElement(\"script\");\n      tag.src = script;\n      document.head.appendChild(tag);\n    });\n  }\n\n  private _logRouteName(oRouter: any): void {\n    const authInfo = getConfidentialInfo()\n    const userLock = this.getModel(\"userModel\") as JSONModel;\n    this.oDataModel = this?.getModel() as ODataModel\n\n    oRouter.attachRouteMatched(async (ev: any) => {\n      const oRouteName = ev.getParameter(\"name\");\n      let userEmail = ((sap.ushell as any).Container?.getService(\"UserInfo\") as any)?.getEmail();\n      if (authInfo.production === false) { userEmail = authInfo.mockEmail }\n      if (!userEmail) {\n        return oRouter.navTo(\"RouteError\");\n      }\n      const userId = userEmail?.includes('@') ? userEmail.split('@')[0].toString() : userEmail.toString()\n      let newUser = JSON.stringify(parseInt(userId))\n      // console.log(\"component.ts userId\", newUser)\n      userLock.setProperty(\"/userId\", newUser)\n      console.log(\"Intial userID\", newUser)\n      // CPI ACL CONFIG\n      // const payload = {\n      // }\n\n      // const POST = async (\n      //   model: any,  // ODataV4Model\n      //   entitySet: string,\n      //   newData: any\n      // ): Promise<any> => {\n      //   return new Promise((resolve, reject) => {\n      //     // Bind the entity set to the ListBinding to perform the POST\n      //     const listBinding = model.bindList(entitySet);\n\n      //     // Call the create method and pass success/error callbacks\n      //     const contextBinding = listBinding.create(newData, false, {\n      //       success: (createdEntity: any) => {\n      //         console.log(\"Record created successfully!\", createdEntity);\n      //         resolve(createdEntity);  // Resolve with the created record data\n      //       },\n      //       error: (error: any) => {\n      //         console.log(\"Error creating record:\", error);\n      //         reject(error);  // Reject in case of an error\n      //       }\n      //     });\n\n      //     if (!contextBinding) {\n      //       reject(new Error(\"Failed to create context binding\"));\n      //     }\n      //   });\n      // };\n\n\n      // try {\n      //   let userAccess2 = await POST(this.oDataModel, '/cpiAcl', payload)\n      //   console.log(userAccess2)\n      // } catch (error) {\n      //   console.error(error)\n      // }\n\n      // const userAccess2 = await GET(this.oDataModel, `/cpiAcl`) as [];\n\n      // console.log(\"userAccess2\", userAccess2);\n      // const userAccessEntries = userAccess2[0].feed.entry; // Access the 'entry' array inside the 'feed'\n      // console.log(\"userAccessEntries --------------------------------------\", userAccessEntries)\n\n      // const userIds = userAccessEntries.find((entry: any) => entry.content.properties.userId === userId);\n      // const userData = userIds.content.properties\n      // console.log(\"userData\", userData);\n      // END CPI ACL CONFIG\n\n\n      // const userAccess = await GET(this.oDataModel, `/Access_UserSet`) as []\n      // const userData = userAccess.find((item: any) => item.appId === authInfo.AppId && item.userId === userId) as any\n      // const userData = userAccess.find((item: any) => item.userId === userId) as any\n      // console.log(userData)\n\n\n      // if (!userData || !userData?.status) {\n      //   return oRouter.navTo(\"RouteError\");\n      // }\n      const userAuthentication = {\n        reports: true,\n        create: true,\n        settings: true,\n        analytics: true\n      }\n      // console.log(\"userAuthentication\", userAuthentication)\n      userLock.setProperty(\"/auth\", userAuthentication)\n\n      const navListModel = this?.getModel('navList') as JSONModel\n      const navListData = [\n        {\n          \"title\": \"Home\",\n          \"icon\": \"sap-icon://home\",\n          \"key\": \"RouteHome\"\n        },\n        {\n          \"title\": \"Time Sheet\",\n          \"icon\": \"sap-icon://end-user-experience-monitoring\",\n          \"key\": \"RouteAttendance\"\n        },\n        {\n          \"title\": \"My Task\",\n          \"icon\": \"sap-icon://activity-assigned-to-goal\",\n          \"key\": \"RouteMyTask\"\n        },\n        {\n          \"title\": \"Employees\",\n          \"icon\": \"sap-icon://employee\",\n          \"key\": \"RouteDashboard\"\n        },\n        {\n          \"title\": \"Request Status\",\n          \"icon\": \"sap-icon://step\",\n          \"key\": \"RouteRequestStatus\"\n        }\n      ]\n      if (userAuthentication?.create) {\n        navListData.push({\n          \"title\": \"Add Employee\",\n          \"icon\": \"sap-icon://add\",\n          \"key\": \"RouteEmployee\"\n        }, {\n          \"title\": \"Bulk Upload\",\n          \"icon\": \"sap-icon://upload-to-cloud\",\n          \"key\": \"RouteBulkUpload\"\n        });\n      }\n      if (userAuthentication?.settings) {\n        navListData.push({\n          \"title\": \"Settings\",\n          \"icon\": \"sap-icon://action-settings\",\n          \"key\": \"RouteSetting\",\n          \"items\": [\n            {\n              \"title\": \"Workflow Approvers\",\n              \"icon\": \"sap-icon://people-connected\",\n              \"key\": \"RouteApprover\"\n            },\n            {\n              \"title\": \"Master Data\",\n              \"icon\": \"sap-icon://database\",\n              \"key\": \"RouteMasterData\"\n            },\n            {\n              \"title\": \"Reassign request\",\n              \"icon\": \"sap-icon://citizen-connect\",\n              \"key\": \"RouteReassign\"\n            }\n          ]\n        });\n      }\n      navListModel?.setProperty(\"/navigation\", navListData)\n      const authData = userLock.getProperty(\"/auth\");\n      console.log(\"authData\", authData)\n      console.log(\"Route Name\", oRouteName)\n\n      if (oRouteName === \"RouteSettings\" && !authData?.settings || oRouteName === \"RouteApprover\" && !authData?.settings || oRouteName === \"RouteMasterData\" && !authData?.settings || oRouteName === \"RouteReassign\" && !authData?.settings) {\n        return oRouter.navTo(\"RouteError\");\n      }\n      if (oRouteName === \"RouteBulkUpload\" && !authData?.create) {\n        return oRouter.navTo(\"RouteError\");\n      }\n    })\n  }\n}\n"],"mappings":"mHACSA,EAAiBC,EAAA,2BACjBC,EAAmBC,EAAA,uBAO5B,MAGqBC,EAAkBC,EAAaC,OAAA,4BACpCC,SAAW,CACvBC,SAAU,QASLC,KAAI,SAAAC,IAETC,KAAKC,eAELC,sBAAAF,MAEA,MAAMG,EAAUH,KAAKI,YACrBD,EAAQE,aAGRL,KAAKM,cAAcH,GAGnBH,KAAKO,SAASlB,IAAqB,SACrC,EACQY,aAAY,SAAAA,IAClB,MAAMO,EAAU,CACd,8FACA,sEACA,6DACA,6DAEFA,EAAQC,QAASC,IACf,MAAMC,EAAMC,SAASC,cAAc,UACnCF,EAAIG,IAAMJ,EACVE,SAASG,KAAKC,YAAYL,EAAI,EAElC,EAEQL,cAAa,SAAAA,EAACH,GAAoB,MAAAc,EAsFjBjB,KArFvB,MAAMkB,EAAW3B,IACjB,MAAM4B,EAAWnB,KAAKoB,SAAS,aAC/BpB,KAAKqB,WAAarB,MAAMoB,WAExBjB,EAAQmB,mBAAkB,SAAQC,GAAO,IACvC,MAAMC,EAAaD,EAAGE,aAAa,QACnC,IAAIC,EAAcC,IAAIC,OAAeC,WAAWC,WAAW,aAAqBC,WAChF,GAAIb,EAASc,aAAe,MAAO,CAAEN,EAAYR,EAASe,SAAU,CACpE,IAAKP,EAAW,CACd,OAAAQ,QAAAC,QAAOhC,EAAQiC,MAAM,cACvB,CACA,MAAMC,EAASX,GAAWY,SAAS,KAAOZ,EAAUa,MAAM,KAAK,GAAGC,WAAad,EAAUc,WACzF,IAAIC,EAAUC,KAAKC,UAAUC,SAASP,IAEtClB,EAAS0B,YAAY,UAAWJ,GA8DhC,MAAMK,EAAqB,CACzBC,QAAS,KACTC,OAAQ,KACRC,SAAU,KACVC,UAAW,MAGb/B,EAAS0B,YAAY,QAASC,GAE9B,MAAMK,EAAelC,GAAMG,SAAS,WACpC,MAAMgC,EAAc,CAClB,CACEC,MAAS,OACTC,KAAQ,kBACRC,IAAO,aAET,CACEF,MAAS,aACTC,KAAQ,4CACRC,IAAO,mBAET,CACEF,MAAS,UACTC,KAAQ,uCACRC,IAAO,eAET,CACEF,MAAS,YACTC,KAAQ,sBACRC,IAAO,kBAET,CACEF,MAAS,iBACTC,KAAQ,kBACRC,IAAO,uBAGX,GAAIT,GAAoBE,OAAQ,CAC9BI,EAAYI,KAAK,CACfH,MAAS,eACTC,KAAQ,iBACRC,IAAO,iBACN,CACDF,MAAS,cACTC,KAAQ,6BACRC,IAAO,mBAEX,CACA,GAAIT,GAAoBG,SAAU,CAChCG,EAAYI,KAAK,CACfH,MAAS,WACTC,KAAQ,6BACRC,IAAO,eACPE,MAAS,CACP,CACEJ,MAAS,qBACTC,KAAQ,8BACRC,IAAO,iBAET,CACEF,MAAS,cACTC,KAAQ,sBACRC,IAAO,mBAET,CACEF,MAAS,mBACTC,KAAQ,6BACRC,IAAO,mBAIf,CACAJ,GAAcN,YAAY,cAAeO,GACzC,MAAMM,EAAWvC,EAASwC,YAAY,SAItC,GAAInC,IAAe,kBAAoBkC,GAAUT,UAAYzB,IAAe,kBAAoBkC,GAAUT,UAAYzB,IAAe,oBAAsBkC,GAAUT,UAAYzB,IAAe,kBAAoBkC,GAAUT,SAAU,CACtO,OAAAf,QAAAC,QAAOhC,EAAQiC,MAAM,cACvB,CACA,GAAIZ,IAAe,oBAAsBkC,GAAUV,OAAQ,CACzD,OAAAd,QAAAC,QAAOhC,EAAQiC,MAAM,cACvB,CAAC,OAAAF,QAAAC,SACH,CAAC,MAAAyB,GAAA,OAAA1B,QAAA2B,OAAAD,EAAA,GACH,IAAC,OAzMkBnE,CAAS","ignoreList":[]}